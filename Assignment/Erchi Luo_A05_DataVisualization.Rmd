---
title: "Assignment 5: Data Visualization"
author: "Erchi Luo"
date: "Spring 2026"
output: pdf_document
geometry: margin=2.54cm
fig_height: 3
fig_width: 4
editor_options: 
  chunk_output_type: console
---

## OVERVIEW

This exercise accompanies the lessons in Environmental Data Analytics on Data Visualization 

## Directions
1. Rename this file `<FirstLast>_A05_DataVisualization.Rmd` (replacing `<FirstLast>` with your first and last name).
2. Change "Student Name" on line 3 (above) with your name.
3. Work through the steps, **creating code and output** that fulfill each instruction.
4. Be sure your code is tidy; use line breaks to ensure your code fits in the knitted output.
5. Be sure to **answer the questions** in this assignment document.
6. When you have completed the assignment, **Knit** the text and code into a single PDF file.

---

## Set up your session 

1. Set up your session. Load the tidyverse, here & cowplot packages, and verify your home directory. Read in the NTL-LTER processed data files for nutrients and chemistry/physics for Peter and Paul Lakes (use the tidy `NTL-LTER_Lake_Chemistry_Nutrients_PeterPaul_Processed.csv` version in the Processed_KEY folder) and the processed data file for the Niwot Ridge litter dataset (use the `NEON_NIWO_Litter_mass_trap_Processed.csv` version, again from the Processed_KEY folder). 

2. Make sure R is reading dates as date format; if not change the format to date.

```{r initialize project}
#1 Load packages
library(tidyverse)
library(here)
library(cowplot)

# Verify home directory
here()

# Read in the processed datasets
# Note: Ensure the path matches your folder structure (Data/Processed_KEY/...)
Lake_Chemistry <- read.csv(
  here("Data/Processed_KEY/NTL-LTER_Lake_Chemistry_Nutrients_PeterPaul_Processed.csv"), 
  stringsAsFactors = TRUE
)

Litter_Mass <- read.csv(
  here("Data/Processed_KEY/NEON_NIWO_Litter_mass_trap_Processed.csv"), 
  stringsAsFactors = TRUE
)


#2 Check and change date formats
# Inspect the structure to see the current format
class(Lake_Chemistry$sampledate)
class(Litter_Mass$collectDate)

# Convert to date format using lubridate functions
# Lake data typically uses YYYY-MM-DD or similar; adjust if needed
Lake_Chemistry$sampledate <- as.Date(Lake_Chemistry$sampledate)
Litter_Mass$collectDate <- as.Date(Litter_Mass$collectDate)

# Verify the change
class(Lake_Chemistry$sampledate)
class(Litter_Mass$collectDate)

```
## Define your theme
3. Build a theme and set it as your default theme. Customize the look of at least two of the following: 
 * Plot background
 * Plot title
 * Axis labels
 * Axis ticks/gridlines
 * Legend

```{r build plot theme}
#3 Start with theme_minimal() as a base and then layering custom adjustments
my_theme <- theme_minimal() + 
  theme(
    # Customize plot background: setting to white with no border
    plot.background = element_rect(fill = "white", color = NA),
    
    # Customize plot title: centered, bold, and larger font size
    plot.title = element_text(hjust = 0.5, face = "bold", size = 14),
    
    # Customize axis labels: bold and slightly larger for readability
    axis.title = element_text(face = "bold", size = 12),
    
    # Customize gridlines: keeping major lines faint and removing minor ones
    panel.grid.major = element_line(color = "grey92"),
    panel.grid.minor = element_blank(),
    
    # Customize legend: positioning at the bottom and adding a light border
    legend.position = "bottom",
    legend.background = element_rect(color = "grey80", fill = "white")
  )

# Set the custom theme as the default for all subsequent plots
theme_set(my_theme)

```

## Create graphs
For numbers 4-7, create ggplot graphs and adjust aesthetics to follow best practices for data visualization. Ensure your theme, color palettes, axes, and additional aesthetics are edited accordingly.

4. [NTL-LTER] Plot total phosphorus (`tp_ug`) by phosphate (`po4`), with separate aesthetics for Peter and Paul lakes. Add line(s) of best fit using the `lm` method. Adjust your axes to hide extreme values (hint: change the limits using `xlim()` and/or `ylim()`).

```{r plot total P vs PO4}
#4 Plot Total Phosphorus vs Phosphate
# Aesthetics: x = po4, y = tp_ug, color/shape = lakename (to distinguish Peter and Paul Lakes)
tp_vs_po4_plot <- ggplot(Lake_Chemistry, aes(x = po4, y = tp_ug, color = lakename)) +
  geom_point(alpha = 0.6) + # Use alpha for transparency to handle overplotting
  
  # Add lines of best fit using linear model (lm)
  geom_smooth(method = "lm", se = FALSE) + 
  
  # Set specific axis limits to hide extreme values/outliers
  # Adjust these numbers based on your data distribution (e.g., 0 to 50 for po4 and 0 to 150 for tp)
  xlim(0, 50) +
  ylim(0, 150) +
  
  # Add descriptive labels
  labs(
    title = "Total Phosphorus vs. Phosphate in Peter and Paul Lakes",
    subtitle = "Fitted with Linear Regression (Extreme values hidden)",
    x = expression(paste("Phosphate (", po[4], " \u03bcg/L)")),
    y = expression(paste("Total Phosphorus (", tp, " \u03bcg/L)")),
    color = "Lake Name"
  )

# Display the plot
print(tp_vs_po4_plot)

```


5. [NTL-LTER] Make three separate boxplots of (a) temperature, (b) TP, and (c) TN, with month as the x axis and lake as a color aesthetic. Then, create a cowplot that combines the three graphs. Make sure that only one legend is present and that graph axes are aligned. Show all months, even those where no data was collected. 

Tips:
* Recall the discussion on factors in the lab section as it may be helpful here. 
* Setting an axis text in your theme to `element_blank()` removes the axis text (useful when multiple, aligned plots use the same axis values)
* Setting a legend's position to "none" will remove the legend from a plot.
* Individual plots can have different relative sizes when combined using `cowplot`.

```{r Create boxplots}
#5 a-c. Create individual boxplots

# Preparation: Ensure Month is a factor so all months show up on the x-axis
# Use factor(month, levels = 1:12) to include months without data
Lake_Chemistry$month <- factor(Lake_Chemistry$month, levels = 1:12)

# (a) Temperature Boxplot
temp_plot <- ggplot(Lake_Chemistry, aes(x = month, y = temperature_C, color = lakename)) +
  geom_boxplot() +
  scale_x_discrete(drop = FALSE) + # Force display of empty levels
  labs(y = "Temp (Â°C)", x = NULL) + 
  theme(legend.position = "none")   # Hide legend for individual plots

# (b) Total Phosphorus (TP) Boxplot 
tp_plot <- ggplot(Lake_Chemistry, aes(x = month, y = tp_ug, color = lakename)) +
  geom_boxplot() +
  scale_x_discrete(drop = FALSE) +
  labs(y = "TP (\u03bcg/L)", x = NULL) +
  theme(legend.position = "none")

# (c) Total Nitrogen (TN) Boxplot
tn_plot <- ggplot(Lake_Chemistry, aes(x = month, y = tn_ug, color = lakename)) +
  geom_boxplot() +
  scale_x_discrete(drop = FALSE) +
  labs(y = "TN (\u03bcg/L)", x = "Month") +
  theme(legend.position = "bottom") # We will extract this legend later

# Cowplot Combination Logic

# 1. Extract the legend from the TN plot
legend_shared <- get_legend(tn_plot)

# 2. Now remove the legend from the TN plot to clean it up for the grid
tn_plot <- tn_plot + theme(legend.position = "none")

# 3. Align the three plots vertically
# align = 'v' ensures the y-axis lines up perfectly across all plots
nutrient_grid <- plot_grid(
  temp_plot, 
  tp_plot, 
  tn_plot, 
  ncol = 1, 
  align = 'v', 
  rel_heights = c(1, 1, 1.2) # Bottom plot gets more height for x-axis labels
)

# 4. Assemble the grid and the shared legend into the final figure
final_nutrient_figure <- plot_grid(
  nutrient_grid, 
  legend_shared, 
  ncol = 1, 
  rel_heights = c(10, 1) # Plot takes 90% of space, legend takes 10%
)

# Call the object to display it in the Plots pane
final_nutrient_figure

```

Question: What do you observe about the variables of interest over seasons and between lakes? 

> Answer: My observation:
Seasonal Trends: All three variables follow a strong seasonal pattern, with water temperature peaking in July/August. Nutrients (TP and TN) show higher concentrations and greater variability during the summer months; 
Inter-lake Comparison: While both lakes share nearly identical temperature profiles, Paul Lake consistently exhibits higher median concentrations of TP and TN than Peter Lake, suggesting it is more nutrient-rich.

6. [Niwot Ridge] Plot a subset of the litter dataset by displaying only the "Needles" functional group. Plot the dry mass of needle litter by date and separate by NLCD class with a color aesthetic. (no need to adjust the name of each land use)

7. [Niwot Ridge] Now, plot the same plot but with NLCD classes separated into three facets rather than separated by color. 

```{r Plot litter}
#6 Filter and plot Needle litter mass by date with color aesthetic
litter_needles_plot <- Litter_Mass %>%
  # Filter for the "Needles" functional group
  filter(functionalGroup == "Needles") %>%
  ggplot(aes(x = collectDate, y = dryMass, color = nlcdClass)) +
  geom_point(alpha = 0.6) +
  # Adding a line to help see trends over time
  geom_line(alpha = 0.4) +
  labs(
    title = "Dry Mass of Needle Litter by Date",
    x = "Collection Date",
    y = "Dry Mass (g)",
    color = "NLCD Class"
  )

# Display the plot
litter_needles_plot


#7 Same plot as above but using facet_wrap instead of color
litter_faceted_plot <- Litter_Mass %>%
  filter(functionalGroup == "Needles") %>%
  ggplot(aes(x = collectDate, y = dryMass)) +
  geom_point(color = "darkgreen", alpha = 0.6) +
  geom_line(alpha = 0.4) +
  # Separate into three facets based on NLCD class
  facet_wrap(~nlcdClass, ncol = 1) +
  labs(
    title = "Dry Mass of Needle Litter by NLCD Class",
    x = "Collection Date",
    y = "Dry Mass (g)"
  )

# Display the plot
litter_faceted_plot


```
Question: Which of these plots (6 vs. 7) do you think is more effective, and why? 

> Answer:I think Plot 7 is more effective. While Plot 6 looks more colorful, it seems suffer from "visual noise" or overplotting. Plot 7 separats the NLCD classes into individual panels, the distinct temporal trends and seasonal peaks for each land cover type are clearly visible.